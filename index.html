<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Borang Penilaian Kendiri Edufluencer KPM</title>
    <!-- Pustaka untuk Jana PDF (jsPDF & jsPDF-AutoTable) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* Import Font dari Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

        /* Reset Asas & Styling Utama Body */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f4f7f6;
            color: #333;
            line-height: 1.6;
        }

        .container {
            display: flex;
            min-height: 100vh;
            background-color: #ffffff;
        }

        /* Sidebar / Navigasi Tab di Kiri */
        .sidebar {
            width: 280px;
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 25px;
            position: fixed;
            height: 100%;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            transform: translateX(0);
            transition: transform 0.3s ease-in-out;
            z-index: 100;
        }

        .sidebar-logo {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #34495e;
        }
        .sidebar-logo img {
            max-width: 80%;
            height: auto;
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar ul li a {
            display: block;
            color: #ecf0f1;
            text-decoration: none;
            padding: 12px 18px;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: background-color: 0.3s ease, transform 0.2s ease;
        }

        .sidebar ul li a:hover {
            background-color: #34495e;
            transform: translateX(5px);
        }

        .sidebar ul li a.active {
            background-color: #3498db; /* Warna utama biru */
            font-weight: 600;
            color: #ffffff;
        }

        /* Kandungan Utama di Kanan */
        .content {
            flex-grow: 1;
            padding: 40px;
            transition: margin-left 0.3s ease-in-out;
        }
        
        /* Header Logo */
        .header-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        .header-logo img {
            max-width: 100%;
            height: auto;
        }

        h1, h2, h4 {
            color: #2c3e50;
        }

        h1, h2 {
            margin-bottom: 25px;
            border-bottom: 2px solid #3498db; /* Warna utama biru */
            padding-bottom: 10px;
        }
        
        h4 {
            margin-top: 20px;
        }

        /* Styling Elemen Borang */
        .form-group, .form-group-checkbox {
            margin-bottom: 25px;
        }

        .form-group label, .form-group-checkbox label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="url"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="tel"]:focus,
        input[type="url"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #3498db; /* Warna utama biru */
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
        }

        input:disabled, select:disabled, textarea:disabled {
            background-color: #e9ecef;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .table-wrapper {
            overflow-x: auto;
        }

        /* Styling Jadual */
        table {
            width: 100%;
            min-width: 600px; /* Pastikan jadual tidak terlalu sempit */
            border-collapse: collapse;
            margin: 25px 0;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 15px;
            text-align: left;
            vertical-align: middle;
        }

        th {
            background-color: #34495e;
            color: white;
            font-weight: 600;
        }

        tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        tbody tr:hover {
            background-color: #f1f1f1;
        }

        tr.header-row td {
            background-color: #2980b9; /* Warna biru gelap */
            color: white;
            font-weight: bold;
            text-align: center;
        }

        .rubric-legend {
            background-color: #eaf2f8; /* Warna biru cair */
            border-left: 5px solid #3498db; /* Warna utama biru */
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        /* Custom Select Dropdown for Skor */
        .select-wrapper {
            position: relative;
            width: 100px;
        }
        .skor-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-color: transparent;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 12px;
            width: 100%;
            cursor: pointer;
        }
        .select-wrapper::after {
            content: '▼';
            font-size: 0.8rem;
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
        }

        /* Butang */
        .btn {
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .btn:disabled {
            background-color: #bdc3c7 !important;
            background-image: none !important;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .section-controls {
            margin-top: 20px;
        }
        .section-lock-btn { background: #e74c3c; } /* Warna Merah */
        .section-lock-btn:hover { box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4); }
        .section-unlock-btn { background: #f39c12; display: none; }
        .section-unlock-btn:hover { box-shadow: 0 4px 15px rgba(243, 156, 18, 0.4); }

        .submit-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
            padding: 15px 30px;
            font-size: 1.1rem;
        }
        .submit-btn:hover:not(:disabled) {
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.6);
        }
        
        .pdf-btn {
            background: #7f8c8d;
        }
        .pdf-btn:hover {
            background: #95a5a6;
            box-shadow: 0 4px 15px rgba(127, 140, 141, 0.4);
        }

        /* Info Box & Status Mesej */
        .info-box {
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .info-box h4 { color: #2980b9; margin-top: 15px; }
        #submit-status { margin-top: 15px; font-weight: bold; }
        
        /* Loading Overlay & Modal */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .overlay.show {
            display: flex;
            opacity: 1;
        }
        .modal {
            background: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            color: #333;
            max-width: 400px;
        }
        .modal h3 {
            margin-bottom: 20px;
        }
        .modal-buttons {
            margin-top: 20px;
        }
        .modal-buttons .btn {
            min-width: 100px;
        }
        .success-message {
            font-size: 1.5rem;
            color: white;
            text-align: center;
        }
        .success-message h2 {
            font-size: 3rem;
            color: white;
            border: none;
        }
        
        /* Butang Menu (Hamburger) */
        .menu-toggle {
            display: none; /* Sembunyi pada skrin besar */
            position: fixed;
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 24px;
            z-index: 101;
        }

        /* Footer */
        footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            text-align: center;
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        /* Media Queries untuk Paparan Responsif */
        @media (min-width: 1024px) {
            .content {
                margin-left: 280px;
            }
        }
        
        @media (max-width: 1023px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.open {
                transform: translateX(0);
            }
            .content {
                margin-left: 0;
            }
            .menu-toggle {
                display: block;
            }
        }
        
        @media (max-width: 480px) {
            .content {
                padding: 20px;
            }
            h1 { font-size: 1.5rem; }
            h2 { font-size: 1.2rem; }
        }

    </style>
</head>
<body>
    <div id="pdf-loader" class="overlay">
        <div class="modal">Menjana PDF, sila tunggu...</div>
    </div>
    <div id="confirmation-modal" class="overlay">
        <div class="modal">
            <h3>Pengesahan</h3>
            <p>Adakah anda pasti untuk menghantar borang ini?</p>
            <div class="modal-buttons">
                <button type="button" id="confirm-yes" class="btn submit-btn">Ya, Hantar</button>
                <button type="button" id="confirm-no" class="btn pdf-btn">Batal</button>
            </div>
        </div>
    </div>
    <div id="success-overlay" class="overlay">
        <div class="success-message">
            <h2>✔️</h2>
            <p>Data Berjaya Dihantar!</p>
        </div>
    </div>

    <div class="container">
        <!-- Navigasi Tab di Sebelah Kiri -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-logo">
                <img src="Imej1.png" alt="Logo Sidebar">
            </div>
            <ul>
                <li><a href="#pengenalan" class="nav-link active">Pengenalan</a></li>
                <li><a href="#maklumat-diri" class="nav-link">Maklumat Diri</a></li>
                <li><a href="#bahagian-a" class="nav-link">Bahagian A: Perkongsian</a></li>
                <li><a href="#bahagian-b" class="nav-link">Bahagian B: Sumbangan</a></li>
                <li><a href="#bahagian-c" class="nav-link">Bahagian C: Dimensi Kualiti</a></li>
                <li><a href="#rumusan" class="nav-link">Rumusan Skor</a></li>
                <li><a href="#pengesahan" class="nav-link">Pengesahan & Hantar</a></li>
            </ul>
        </nav>

        <!-- Kandungan Borang di Sebelah Kanan -->
        <main class="content">
            <button type="button" class="menu-toggle" id="menu-toggle">☰</button>
            <form id="edufluencer-form">
                
                <!-- =============== Bahagian Pengenalan =============== -->
                <section id="pengenalan" class="tab-content active">
                    <div class="header-logo">
                        <img src="Imej2.gif" alt="Logo Organisasi">
                    </div>
                    <h1>Borang Penilaian Kendiri Edufluencer KPM</h1>
                    <div class="info-box">
                        <h4>1. Tujuan</h4><p>Borang ini dibangunkan sebagai instrumen penilaian kendiri bagi Edufluencer Kementerian Pendidikan (KPM) untuk menilai tahap profesionalisme, kualiti kandungan, komunikasi dan penyampaian, impak, inovasi serta pembangunan berterusan dalam peranan mereka sebagai pendidik digital.</p>
                        <h4>2. Objektif</h4>
                        <ul>
                            <li>Menilai secara menyeluruh kekuatan dan kelemahan diri sebagai Edufluencer iaitu pengetahuan, kemahiran, nilai serta tahap profesionalisme.</li>
                            <li>Mengenal pasti aspek-aspek utama yang memerlukan penambahbaikan bagi meningkatkan kualiti kandungan, keberkesanan penyampaian, impak kepada audiens serta inovasi dalam amalan digital.</li>
                        </ul>
                         <h4>5. Kerahsiaan</h4><p>Penilaian kendiri ini adalah untuk kegunaan peribadi dan pembangunan profesional. Maklumat yang diisi tidak akan menjejaskan penilaian rasmi kecuali diminta untuk rujukan oleh pihak KPM.</p>
                    </div>
                </section>

                <!-- =============== Bahagian Maklumat Diri =============== -->
                <section id="maklumat-diri" class="tab-content">
                    <h2>Maklumat Peribadi</h2>
                    <div class="form-group"><label for="nama">Nama:</label><input type="text" id="nama" name="nama" required></div>
                    <div class="form-group"><label for="nokp">No. KP:</label><input type="text" id="nokp" name="nokp" required></div>
                    <div class="form-group"><label for="jawatan">Jawatan:</label><input type="text" id="jawatan" name="jawatan"></div>
                    <div class="form-group"><label for="gred">Gred:</label><input type="text" id="gred" name="gred"></div>
                    <div class="form-group"><label for="negeri">Negeri:</label><input type="text" id="negeri" name="negeri"></div>
                    <div class="form-group"><label for="sekolah">Nama Sekolah:</label><input type="text" id="sekolah" name="sekolah"></div>
                    <div class="form-group">
                        <label for="kategori">Kategori:</label>
                        <select id="kategori" name="kategori">
                            <option value="Pra sekolah">Pra sekolah</option><option value="Sekolah Rendah">Sekolah Rendah</option><option value="Sekolah Menengah">Sekolah Menengah</option><option value="Lain-lain">DLL (Nyatakan)</option>
                        </select>
                        <div id="kategori-lain-wrapper" style="display: none; margin-top: 10px;">
                            <input type="text" id="kategori-lain-input" name="kategori_lain" placeholder="Sila nyatakan kategori">
                        </div>
                    </div>
                    <h4>Media Sosial</h4>
                    <p><i>Arahan: Sila isi nama akaun anda. Jika tiada, sila tulis "TIADA".</i></p>
                    <div class="table-wrapper">
                        <table id="social-media-table">
                            <thead><tr><th>Pelantar</th><th>Nama Akaun</th><th>Bilangan Followers</th></tr></thead>
                            <tbody>
                                <tr><td>Facebook<input type="hidden" name="social_pelantar_1" value="Facebook"></td><td><input type="text" name="social_akaun_1" value="TIADA"></td><td><input type="number" name="social_followers_1" value="0"></td></tr>
                                <tr><td>TikTok<input type="hidden" name="social_pelantar_2" value="TikTok"></td><td><input type="text" name="social_akaun_2" value="TIADA"></td><td><input type="number" name="social_followers_2" value="0"></td></tr>
                                <tr><td>Instagram<input type="hidden" name="social_pelantar_3" value="Instagram"></td><td><input type="text" name="social_akaun_3" value="TIADA"></td><td><input type="number" name="social_followers_3" value="0"></td></tr>
                                <tr><td>X<input type="hidden" name="social_pelantar_4" value="X"></td><td><input type="text" name="social_akaun_4" value="TIADA"></td><td><input type="number" name="social_followers_4" value="0"></td></tr>
                                <tr><td>YouTube<input type="hidden" name="social_pelantar_5" value="YouTube"></td><td><input type="text" name="social_akaun_5" value="TIADA"></td><td><input type="number" name="social_followers_5" value="0"></td></tr>
                                <tr><td>Threads<input type="hidden" name="social_pelantar_6" value="Threads"></td><td><input type="text" name="social_akaun_6" value="TIADA"></td><td><input type="number" name="social_followers_6" value="0"></td></tr>
                                <tr><td><input type="text" name="social_pelantar_7" placeholder="Lain-lain..."></td><td><input type="text" name="social_akaun_7" value="TIADA"></td><td><input type="number" name="social_followers_7" value="0"></td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="section-controls">
                        <button type="button" class="btn section-lock-btn" data-section="maklumat-diri">Selesai</button>
                        <button type="button" class="btn section-unlock-btn" data-section="maklumat-diri">Kemaskini</button>
                    </div>
                </section>

                <!-- =============== Bahagian A: Perkongsian Amalan (40%) =============== -->
                <section id="bahagian-a" class="tab-content">
                    <h2>BAHAGIAN A: PERKONGSIAN AMALAN (40%)</h2>
                    <p><strong>Arahan:</strong> Sila senaraikan sehingga lima (5) aktiviti dan bukti perkongsian amalan yang telah dilaksanakan.</p>
                    <div class="table-wrapper">
                        <table id="bahagian-a-table">
                            <thead><tr><th>Bil</th><th>Jenis Perkongsian</th><th>Tajuk</th><th>Medium</th><th>Pautan/Bukti</th><th>Skor</th></tr></thead>
                            <tbody id="table-body-a"></tbody>
                        </table>
                    </div>
                    <h4>Rubrik Bahagian A</h4>
                    <div class="table-wrapper">
                        <table>
                            <thead><tr><th>Skor</th><th>Kriteria</th></tr></thead>
                            <tbody>
                                <tr><td>5</td><td>Perkongsian amalan inovatif, berimpak tinggi, pelibatan melebihi 1000 engagement</td></tr>
                                <tr><td>4</td><td>Amalan baik yang jelas, disampaikan dalam bentuk kreatif, pelibatan 500–999</td></tr>
                                <tr><td>3</td><td>Perkongsian berkualiti sederhana, capaian sekitar 200–499</td></tr>
                                <tr><td>2</td><td>Kandungan asas, kurang penglibatan atau pengaruh</td></tr>
                                <tr><td>1</td><td>Perkongsian terlalu ringkas atau tiada elemen nilai tambah</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="section-controls">
                        <button type="button" class="btn section-lock-btn" data-section="bahagian-a">Selesai</button>
                        <button type="button" class="btn section-unlock-btn" data-section="bahagian-a">Kemaskini</button>
                    </div>
                </section>

                <!-- =============== Bahagian B: Sumbangan Profesional (20%) =============== -->
                <section id="bahagian-b" class="tab-content">
                     <h2>BAHAGIAN B: SUMBANGAN KHIDMAT PROFESIONAL (20%)</h2>
                     <p><strong>Arahan:</strong> Sila nyatakan bentuk sumbangan khidmat profesional yang telah diberikan.</p>
                     <div class="table-wrapper">
                         <table id="bahagian-b-table">
                            <thead><tr><th>Bil</th><th>Program</th><th>Peranan</th><th>Tarikh/Tahun</th><th>Penganjur</th><th>Skor</th></tr></thead>
                            <tbody id="table-body-b"></tbody>
                        </table>
                     </div>
                    <h4>Rubrik Bahagian B</h4>
                    <div class="table-wrapper">
                        <table>
                            <thead><tr><th>Skor</th><th>Kriteria</th></tr></thead>
                            <tbody>
                                <tr><td>5</td><td>Program besar / pelbagai lokasi, impak jelas, diiktiraf (oleh PPD/JPN/KPM)</td></tr>
                                <tr><td>4</td><td>Khidmat bantu berkala, pelibatan aktif bersama komuniti guru/murid</td></tr>
                                <tr><td>3</td><td>Sekali/sementara tetapi terancang dan memberi impak positif</td></tr>
                                <tr><td>2</td><td>Terhad, bersifat dalaman sahaja</td></tr>
                                <tr><td>0</td><td>Tiada khidmat bantu</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="section-controls">
                        <button type="button" class="btn section-lock-btn" data-section="bahagian-b">Selesai</button>
                        <button type="button" class="btn section-unlock-btn" data-section="bahagian-b">Kemaskini</button>
                    </div>
                </section>

                <!-- =============== Bahagian C: Dimensi Kualiti (40%) =============== -->
                <section id="bahagian-c" class="tab-content">
                     <h2>BAHAGIAN C: DIMENSI KUALITI (40%)</h2>
                     <p><strong>Arahan:</strong> Tandakan pada ruangan 1–5 berdasarkan tahap pencapaian anda.</p>
                     <div class="rubric-legend"><strong>Skala: 1</strong>=Sangat Lemah, <strong>2</strong>=Lemah, <strong>3</strong>=Sederhana, <strong>4</strong>=Baik, <strong>5</strong>=Cemerlang</div>
                     <div class="table-wrapper">
                        <table id="table-c">
                            <thead><tr><th>Bil</th><th>Kriteria</th><th>Skor (1-5)</th></tr></thead>
                            <tbody id="table-body-c"></tbody>
                        </table>
                     </div>
                    <div class="section-controls">
                        <button type="button" class="btn section-lock-btn" data-section="bahagian-c">Selesai</button>
                        <button type="button" class="btn section-unlock-btn" data-section="bahagian-c">Kemaskini</button>
                    </div>
                </section>
                
                 <!-- =============== Bahagian Rumusan Skor =============== -->
                <section id="rumusan" class="tab-content">
                    <h2>RUMUSAN SKOR KESELURUHAN</h2>
                    <div class="table-wrapper">
                        <table>
                            <thead><tr><th>Komponen</th><th>Skor Diperoleh</th><th>Peratus Skor Diperolehi (%)</th></tr></thead>
                            <tbody>
                                <tr><td>BAHAGIAN A (40%)</td><td><input type="text" id="skor-a-rumusan" readonly></td><td><input type="text" id="peratus-a-rumusan" readonly></td></tr>
                                <tr><td>BAHAGIAN B (20%)</td><td><input type="text" id="skor-b-rumusan" readonly></td><td><input type="text" id="peratus-b-rumusan" readonly></td></tr>
                                <tr><td>BAHAGIAN C (40%)</td><td><input type="text" id="skor-c-rumusan" readonly></td><td><input type="text" id="peratus-c-rumusan" readonly></td></tr>
                            </tbody>
                            <tfoot>
                                <tr><td><strong>JUMLAH KESELURUHAN (%)</strong></td><td colspan="2"><input type="text" id="jumlah-keseluruhan" readonly></td></tr>
                                <tr><td><strong>TAHAP</strong></td><td colspan="2"><input type="text" id="tahap-pencapaian" readonly></td></tr>
                            </tfoot>
                        </table>
                    </div>
                     <div class="info-box">
                        <h4>Penerangan Tahap</h4>
                        <p><strong>TopInfluencer (90-100):</strong> Edufluencer berimpak tinggi yang konsisten, inovatif, dan menjadi rujukan utama dalam komuniti pendidikan.</p>
                        <p><strong>Trendsetter (80-89.99):</strong> Edufluencer kreatif dan inovatif yang mampu mencetuskan idea baharu serta menginspirasi warga pendidikan.</p>
                        <p><strong>Next Gen (60-79.99):</strong> Edufluencer aktif dengan kandungan asas yang bermanfaat dan berpotensi berkembang ke tahap lebih tinggi.</p>
                        <p><strong>Starter (0-59.99):</strong> Edufluencer baharu yang masih memerlukan bimbingan untuk meningkatkan mutu kandungan dan impak pendidikan.</p>
                    </div>
                </section>

                <!-- =============== Bahagian Pengesahan & Hantar =============== -->
                <section id="pengesahan" class="tab-content">
                    <h2>Pengesahan dan Akuan</h2>
                    <div class="form-group-checkbox">
                        <input type="checkbox" id="akuan" name="akuan" value="YA" required style="width: auto; margin-right: 10px;">
                        <label for="akuan">Saya mengesahkan bahawa semua maklumat dan bukti yang dikemukakan adalah benar dan tepat.</label>
                    </div>
                    <div class="form-group"><label for="nama_pengesahan">Nama:</label><input type="text" id="nama_pengesahan" name="nama_pengesahan" readonly></div>
                    <div class="form-group"><label for="email_pengesahan">Emel:</label><input type="email" id="email_pengesahan" name="email_pengesahan" required></div>
                    <div class="form-group"><label for="telefon_pengesahan">No. Telefon:</label><input type="tel" id="telefon_pengesahan" name="telefon_pengesahan" required></div>
                    <div class="form-group"><label for="tarikh_pengesahan">Tarikh:</label><input type="text" id="tarikh_pengesahan" name="tarikh_pengesahan" readonly></div>
                    <button type="button" id="download-pdf-btn" class="btn pdf-btn">Muat Turun PDF</button>
                    <button type="submit" id="submit-btn" class="btn submit-btn">Hantar</button>
                    <p id="submit-status"></p>
                </section>
            </form>
            
            <footer>
                <p>Penafian: Borang ini adalah untuk tujuan penilaian kendiri dan pembangunan profesional sahaja. Maklumat yang diberikan adalah sulit.</p>
                <p>MeY || ©2025</p>
            </footer>
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const { jsPDF } = window.jspdf;
        
        // --- DATA UNTUK JADUAL BAHAGIAN C ---
        const kriteriaC = {
            "PROFESIONALISME": ["Menjaga etika sebagai pendidik dalam setiap kandungan yang dihasilkan", "Mematuhi dasar, garis panduan dan sensitiviti Kementerian Pendidikan", "Menghasilkan kandungan yang berinovatif dan bermanfaat"],
            "KANDUNGAN": ["Kandungan bahan yang disediakan jelas dan teratur", "Kandungan mengandungi elemen kreatif dan inovatif yang menarik minat untuk belajar.", "Kandungan yang dikongsi berkaitan pengajaran dan pembelajaran (PdP)", "Kandungan yang dikongsi adalah berhubung dengan keperluan pendidikan semasa"],
            "KOMUNIKASI": ["Penyampaian mesej jelas dan mudah difahami", "Menghormati pendapat pengikut dengan berinteraksi secara positif", "Keberkesanan gaya penyampaian dalam mengekalkan perhatian"],
            "IMPAK DAN PENGARUH": ["Kandungan memberi kesan positif kepada audiens (murid/guru/masyarakat)", "Berupaya menjadi rujukan dan inspirasi kepada komuniti pendidikan", "Menggalakkan interaksi dan kolaborasi dengan warga pendidik"]
        };

        // --- FUNGSI UNTUK MEMBINA JADUAL SECARA DINAMIK ---
        
        function createScoreSelect(prefix, rowNumber) {
            let select = `<div class="select-wrapper"><select name="${prefix}_skor_${rowNumber}" class="${prefix}-skor skor-select">`;
            for (let i = 0; i <= 5; i++) { select += `<option value="${i}">${i}</option>`; }
            select += `</select></div>`;
            return select;
        }

        function initializeTables() {
            // Bina Jadual Bahagian A (5 baris tetap)
            const tableBodyA = document.getElementById('table-body-a');
            tableBodyA.innerHTML = ''; // Kosongkan dahulu
            for (let i = 1; i <= 5; i++) {
                const newRow = tableBodyA.insertRow();
                newRow.innerHTML = `
                    <td>${i}</td>
                    <td><input type="text" name="a_jenis_${i}"></td>
                    <td><input type="text" name="a_tajuk_${i}"></td>
                    <td><input type="text" name="a_medium_${i}"></td>
                    <td><input type="url" name="a_pautan_${i}"></td>
                    <td>${createScoreSelect('a', i)}</td>
                `;
            }
            
            // Bina Jadual Bahagian B (5 baris tetap)
            const tableBodyB = document.getElementById('table-body-b');
            tableBodyB.innerHTML = ''; // Kosongkan dahulu
            for (let i = 1; i <= 5; i++) {
                const newRow = tableBodyB.insertRow();
                newRow.innerHTML = `
                    <td>${i}</td>
                    <td><input type="text" name="b_program_${i}"></td>
                    <td><input type="text" name="b_peranan_${i}"></td>
                    <td><input type="text" name="b_tarikh_${i}"></td>
                    <td><input type="text" name="b_penganjur_${i}"></td>
                    <td>${createScoreSelect('b', i)}</td>
                `;
            }

            const tableBodyC = document.getElementById('table-body-c');
            tableBodyC.innerHTML = ''; // Kosongkan dahulu
            let bilC = 1;
            for (const tajuk in kriteriaC) {
                const headerRow = tableBodyC.insertRow();
                headerRow.className = 'header-row';
                const headerCell = headerRow.insertCell();
                headerCell.colSpan = 3;
                headerCell.textContent = tajuk;

                kriteriaC[tajuk].forEach(kriteria => {
                    const newRow = tableBodyC.insertRow();
                    newRow.innerHTML = `
                        <td>${bilC}</td>
                        <td>${kriteria}</td>
                        <td><div class="select-wrapper"><select name="c_skor_${bilC}" class="skor-c skor-select"></select></div></td>
                    `;
                    const select = newRow.querySelector('select');
                    for (let i=0; i<=5; i++) {
                        select.add(new Option(i, i));
                    }
                    bilC++;
                });
            }
        }
        
        // --- LOGIK NAVIGASI TAB ---
        const navLinks = document.querySelectorAll('.nav-link');
        const tabContents = document.querySelectorAll('.tab-content');
        const sidebar = document.getElementById('sidebar');
        const menuToggle = document.getElementById('menu-toggle');

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                navLinks.forEach(item => item.classList.remove('active'));
                link.classList.add('active');
                const targetId = link.getAttribute('href').substring(1);
                tabContents.forEach(content => {
                    content.style.display = 'none'; // Sembunyikan semua tab
                });
                document.getElementById(targetId).style.display = 'block'; // Tunjuk tab yang dipilih sahaja
                
                if (window.innerWidth < 1024) {
                    sidebar.classList.remove('open');
                }
            });
        });
        
        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('open');
        });

        // --- FUNGSI PENGIRAAN SKOR AUTOMATIK ---
        function calculateScores() {
            let totalA = Array.from(document.querySelectorAll('.a-skor')).reduce((sum, el) => sum + parseInt(el.value), 0);
            document.getElementById('skor-a-rumusan').value = totalA;
            const peratusA = (totalA / 25) * 40;
            document.getElementById('peratus-a-rumusan').value = peratusA.toFixed(2);
            
            let totalB = Array.from(document.querySelectorAll('.b-skor')).reduce((sum, el) => sum + parseInt(el.value), 0);
            document.getElementById('skor-b-rumusan').value = totalB;
            const peratusB = (totalB / 25) * 20;
            document.getElementById('peratus-b-rumusan').value = peratusB.toFixed(2);

            let totalC = Array.from(document.querySelectorAll('.skor-c')).reduce((sum, el) => sum + parseInt(el.value), 0);
            document.getElementById('skor-c-rumusan').value = totalC;
            const peratusC = (totalC / 65) * 40;
            document.getElementById('peratus-c-rumusan').value = peratusC.toFixed(2);

            const jumlahKeseluruhan = parseFloat(peratusA) + parseFloat(peratusB) + parseFloat(peratusC);
            document.getElementById('jumlah-keseluruhan').value = jumlahKeseluruhan.toFixed(2);

            let tahap = 'Starter';
            if (jumlahKeseluruhan >= 90) tahap = 'TopInfluencer';
            else if (jumlahKeseluruhan >= 80) tahap = 'Trendsetter';
            else if (jumlahKeseluruhan >= 60) tahap = 'Next Gen';
            document.getElementById('tahap-pencapaian').value = tahap;
        }

        // --- EVENT LISTENERS ---
        document.querySelector('.content').addEventListener('change', function(e) {
            if (e.target.matches('.a-skor, .b-skor, .skor-c')) { calculateScores(); }
        });
        
        document.getElementById('kategori').addEventListener('change', function() {
            document.getElementById('kategori-lain-wrapper').style.display = (this.value === 'Lain-lain') ? 'block' : 'none';
        });

        document.querySelector('.content').addEventListener('click', function(e) {
            if (e.target.matches('.section-lock-btn, .section-unlock-btn')) {
                const sectionId = e.target.dataset.section;
                const section = document.getElementById(sectionId);
                const inputs = section.querySelectorAll('input, select');
                const isLocking = e.target.classList.contains('section-lock-btn');
                inputs.forEach(input => input.disabled = isLocking);
                section.querySelector('.section-lock-btn').style.display = isLocking ? 'none' : 'inline-block';
                section.querySelector('.section-unlock-btn').style.display = isLocking ? 'inline-block' : 'none';
            }
        });
        
        // --- FUNGSI BANTUAN ---
        document.getElementById('nama').addEventListener('input', (e) => {
            document.getElementById('nama_pengesahan').value = e.target.value;
        });
        document.getElementById('tarikh_pengesahan').value = new Date().toLocaleDateString('ms-MY', { year: 'numeric', month: 'long', day: 'numeric' });

        // --- LOGIK PENGESAHAN & KAWALAN BUTANG HANTAR ---
        const submitBtn = document.getElementById('submit-btn');
        const requiredFields = document.querySelectorAll('#pengesahan [required]');
        
        function validateForm() {
            let allValid = true;
            requiredFields.forEach(field => {
                if (field.type === 'checkbox') {
                    if (!field.checked) allValid = false;
                } else {
                    if (field.value.trim() === '') allValid = false;
                }
            });
            submitBtn.disabled = !allValid;
        }
        document.getElementById('pengesahan').addEventListener('input', validateForm);
        document.getElementById('pengesahan').addEventListener('change', validateForm);

        // --- LOGIK MUAT TURUN PDF (VERSI DIPERBAIKI) ---
        document.getElementById('download-pdf-btn').addEventListener('click', function() {
            const loader = document.getElementById('pdf-loader');
            loader.style.display = 'flex';

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const docName = document.getElementById('nama').value || 'responden';

                let y = 15;
                const addText = (text, size = 10, style = 'normal', indent = 10) => {
                    if (y > 280) { doc.addPage(); y = 15; }
                    doc.setFontSize(size).setFont('helvetica', style);
                    doc.text(text, indent, y);
                    y += (size * 0.5);
                };

                addText('Borang Penilaian Kendiri Edufluencer KPM', 18, 'bold', 10);
                y += 5;

                addText('Maklumat Peribadi', 14, 'bold');
                const maklumat = { "Nama": "nama", "No. KP": "nokp", "Jawatan": "jawatan", "Gred": "gred", "Negeri": "negeri", "Nama Sekolah": "sekolah", "Kategori": "kategori" };
                for (const [label, id] of Object.entries(maklumat)) { addText(`${label}: ${document.getElementById(id).value}`); }
                if (document.getElementById('kategori').value === 'Lain-lain') { addText(`Kategori (Lain-lain): ${document.getElementById('kategori-lain-input').value}`); }
                y += 5;

                const socialTableBody = Array.from(document.querySelectorAll('#social-media-table tbody tr')).map(row => {
                    const pelantarCell = row.cells[0];
                    let pelantar = pelantarCell.innerText;
                    if (pelantarCell.querySelector('input')) {
                        pelantar = pelantarCell.querySelector('input').value;
                    }
                    return [pelantar, row.querySelector('input[name^="social_akaun"]').value, row.querySelector('input[name^="social_followers"]').value];
                });
                if (socialTableBody.length > 0) {
                    doc.autoTable({ head: [['Pelantar', 'Nama Akaun', 'Followers']], body: socialTableBody, startY: y });
                    y = doc.autoTable.previous.finalY + 10;
                }

                addText('Bahagian A: Perkongsian Amalan', 14, 'bold');
                const partATableBody = Array.from(document.querySelectorAll('#bahagian-a-table tbody tr')).map(row => [
                    row.cells[0].innerText,
                    row.querySelector('input[name^="a_jenis_"]').value,
                    row.querySelector('input[name^="a_tajuk_"]').value,
                    row.querySelector('input[name^="a_medium_"]').value,
                    row.querySelector('.a-skor').value
                ]);
                if (partATableBody.length > 0) {
                    doc.autoTable({ head: [['Bil', 'Jenis', 'Tajuk', 'Medium', 'Skor']], body: partATableBody, startY: y });
                    y = doc.autoTable.previous.finalY + 10;
                }

                addText('Bahagian B: Sumbangan Khidmat Profesional', 14, 'bold');
                const partBTableBody = Array.from(document.querySelectorAll('#bahagian-b-table tbody tr')).map(row => [
                    row.cells[0].innerText,
                    row.querySelector('input[name^="b_program_"]').value,
                    row.querySelector('input[name^="b_peranan_"]').value,
                    row.querySelector('input[name^="b_tarikh_"]').value,
                    row.querySelector('.b-skor').value
                ]);
                if (partBTableBody.length > 0) {
                    doc.autoTable({ head: [['Bil', 'Program', 'Peranan', 'Tarikh', 'Skor']], body: partBTableBody, startY: y });
                    y = doc.autoTable.previous.finalY + 10;
                }
                
                // Mula muka surat baharu untuk Bahagian C
                doc.addPage();
                y = 15;

                addText('Bahagian C: Dimensi Kualiti', 14, 'bold');
                const partCTableBody = Array.from(document.querySelectorAll('#table-c tbody tr:not(.header-row)')).map(row => [
                    row.cells[0].innerText,
                    row.cells[1].innerText,
                    row.querySelector('.skor-c').value
                ]);
                if (partCTableBody.length > 0) {
                    doc.autoTable({ head: [['Bil', 'Kriteria', 'Skor']], body: partCTableBody, startY: y });
                    y = doc.autoTable.previous.finalY + 10;
                }

                if (y > 220) { doc.addPage(); y = 15; }
                addText('Rumusan Skor Keseluruhan', 14, 'bold');
                const rumusanData = [
                    ['Bahagian A', document.getElementById('skor-a-rumusan').value, document.getElementById('peratus-a-rumusan').value + ' %'],
                    ['Bahagian B', document.getElementById('skor-b-rumusan').value, document.getElementById('peratus-b-rumusan').value + ' %'],
                    ['Bahagian C', document.getElementById('skor-c-rumusan').value, document.getElementById('peratus-c-rumusan').value + ' %'],
                ];
                doc.autoTable({ head: [['Komponen', 'Skor Diperoleh', 'Peratus (%)']], body: rumusanData, startY: y });
                y = doc.autoTable.previous.finalY + 5;
                addText(`Jumlah Keseluruhan: ${document.getElementById('jumlah-keseluruhan').value} %`, 12, 'bold');
                addText(`Tahap: ${document.getElementById('tahap-pencapaian').value}`, 12, 'bold');
                
                doc.save(`Borang Penilaian Kendiri - ${docName}.pdf`);
            } catch (error) {
                console.error("Ralat semasa menjana PDF:", error);
                alert("Maaf, terdapat ralat semasa menjana PDF. Sila cuba lagi.");
            } finally {
                loader.style.display = 'none';
            }
        });

        // --- LOGIK PENGHANTARAN BORANG ---
        const form = document.getElementById('edufluencer-form');
        const confirmationModal = document.getElementById('confirmation-modal');
        const successOverlay = document.getElementById('success-overlay');

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            confirmationModal.classList.add('show');
        });

        document.getElementById('confirm-no').addEventListener('click', function() {
            confirmationModal.classList.remove('show');
        });

        document.getElementById('confirm-yes').addEventListener('click', function() {
            confirmationModal.classList.remove('show');
            const submitStatus = document.getElementById('submit-status');
            const scriptURL = 'https://script.google.com/macros/s/AKfycbzMUiS883MqTjynTz9hIPBEbZxK8CWOXpHGM3ci4SPeJ7eMUi5C73_7kOOr6f6wAmPKtg/exec';
            const formData = new FormData(form);
            submitStatus.textContent = 'Menghantar data...';
            submitStatus.style.color = '#333';
            
            fetch(scriptURL, { method: 'POST', body: formData })
                .then(response => response.json()) 
                .then(data => {
                    if (data.result === 'success') {
                        successOverlay.classList.add('show');
                        setTimeout(() => {
                            successOverlay.classList.remove('show');
                            form.reset();
                            initializeTables();
                            calculateScores();
                            validateForm();
                            document.querySelector('.nav-link[href="#pengenalan"]').click();
                            submitStatus.textContent = '';
                        }, 3000);
                    } else {
                        throw new Error(data.error || 'Penghantaran gagal dari skrip.');
                    }
                })
                .catch(error => {
                    submitStatus.textContent = 'Ralat! Borang tidak dapat dihantar. Sila semak sambungan & tetapan Apps Script.';
                    submitStatus.style.color = 'red';
                    console.error('Error!', error.message);
                });
        });
        
        // Panggil fungsi untuk memulakan borang
        initializeTables();
        calculateScores();
        validateForm(); 
    });
    </script>
</body>
</html>
